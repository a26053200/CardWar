---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zheng.
--- DateTime: 2020/7/21 23:22
---

local ReportCardItem = require("Game.Modules.CheckPoint.View.ReportCardItem")
local ListItemRenderer = require("Betel.UI.ListItemRenderer")
---@class Game.Modules.CheckPoint.View.CheckPointReportItem: Betel.UI.ListItemRenderer
local CheckPointReportItem = class("Game.Modules.CheckPoint.View.CheckPointReportItem",ListItemRenderer)

---@param gameObject UnityEngine.GameObject
function CheckPointReportItem:Ctor(gameObject)
    CheckPointReportItem.super.Ctor(self,gameObject)
end

---@param reportVo Game.Modules.Battle.Vo.BattleReportVo
function CheckPointReportItem:UpdateItem(reportVo, index)
    CheckPointReportItem.super.UpdateItem(self, reportVo, index)

    local starBar = self.gameObject:FindChild("Info/StarBar")
    --self:SetStar(starBar, reportVo.star)
    --starBar:SetActive(cardVo.fragmentStoneNum == 0)

    local levelText = self.gameObject:GetText("Info/Level/Text")
    levelText.text = "Lv." .. reportVo.roleLevel

    local ceText = self.gameObject:GetText("Info/CE/Text")
    ceText.text = "战斗力 " .. reportVo.roleLevel

    self:InitCardList(reportVo)

    LuaHelper.AddObjectClickEvent(self.gameObject:FindChild("Btn/BtnReplay"), handler(self, self.OnReplay))
    --cell.gameObject:GetOrAddComponent(typeof(Framework.ClickFeedback))
end

function CheckPointReportItem:OnReplay()
    self.listView.eventDispatcher:DispatchEvent({type = "CheckPointReportReplay", reportVo = self.data})
end

---@param reportVo Game.Modules.Battle.Vo.BattleReportVo
function CheckPointReportItem:InitCardList(reportVo)
    self.cardList = TableList.New(self.gameObject:FindChild("List/ListView"), ReportCardItem)
    self.cardList:SetData(List.New(reportVo.battleUnits))
    self.cardList:SetScrollEnable(false)
end

---@param starBar UnityEngine.GameObject
function CheckPointReportItem:SetStar(starBar, starNum)
    for i = 1, starBar.transform.childCount do
        local starImg = starBar.transform:GetChild(i - 1).gameObject:GetImage()
        starImg.sprite = UITools.GetSprite(starImg.gameObject, i <= starNum and 1 or 0)
    end
end

function CheckPointReportItem:OnDestroy()

end

return CheckPointReportItem