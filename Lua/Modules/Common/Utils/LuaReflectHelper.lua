---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zheng.
--- DateTime: 2020/4/24 23:02
--- Lua反射
---

local json = require("cjson")
local LuaReflectHelper = {}

local Key =
{
    BattleUnitVo = "BattleUnitVo",
    BattleUnitInfo = "BattleUnitInfo",
    Avatar = "Avatar",
    Skill = "Skill",
    Account = "Account",
    Anim = "Anim",
    Performance = "Performance",
}

---@param unit Game.Modules.World.Items.BattleUnit
---@param battleUnitVo Game.Modules.Battle.Vo.BattleUnitVo
function LuaReflectHelper.PushVo(unit, battleUnitVo)
    if unit.luaReflect then
        unit.luaReflect:Push("Camp", battleUnitVo.camp)
        unit.luaReflect:Push("layoutIndex", tostring(unit.layoutIndex))
        unit.luaReflect:PushLuaJson(Key.BattleUnitInfo, json.encode(battleUnitVo.battleUnitInfo))
        unit.luaReflect:PushLuaJson(Key.Avatar, json.encode(battleUnitVo.avatarInfo))
        for i = 1, #battleUnitVo.skills do
            unit.luaReflect:PushLuaJsonArray(Key.Skill, json.encode(battleUnitVo.skills[i].skillInfo))
        end
    end
end

---@param unit Game.Modules.World.Items.BattleUnit
---@param jsonData string
function LuaReflectHelper.JsonToLua(unit, key, jsonData)
    if unit.luaReflect then
        if key == Key.BattleUnitInfo then
            unit.battleUnitVo.battleUnitInfo = json.decode(jsonData)
        elseif key == Key.Avatar then
            unit.battleUnitVo.avatarInfo = json.decode(jsonData)
        elseif key == Key.Skill then
            local skillInfo = json.decode(jsonData)
            for i = 1, #unit.battleUnitVo.skills do
                if skillInfo.id == unit.battleUnitVo.skills[i].skillInfo.id then
                    unit.battleUnitVo.skills[i].skillInfo = skillInfo
                    break;
                end
            end
        end
    end
end

return LuaReflectHelper