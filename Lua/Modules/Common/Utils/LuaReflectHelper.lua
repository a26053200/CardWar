---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zheng.
--- DateTime: 2020/4/24 23:02
--- Lua反射
---

local json = require("cjson")
local LuaReflectHelper = {}

local Key =
{
    BattleUnitVo = "BattleUnitVo",
    BattleUnitInfo = "BattleUnitInfo",
    Avatar = "Avatar",
    Skill = "Skill",
    Account = "Account",
    Anim = "Anim",
    Performance = "Performance",
}

---@param unit Game.Modules.World.Items.BattleUnit
---@param battleUnitVo Game.Modules.Battle.Vo.BattleUnitVo
function LuaReflectHelper.PushVo(unit, battleUnitVo)
    if unit.luaReflect then
        unit.luaReflect:Push("Camp", battleUnitVo.camp)
        unit.luaReflect:Push("layoutIndex", tostring(unit.layoutIndex))
        unit.luaReflect:PushLuaJson(Key.BattleUnitInfo, json.encode(battleUnitVo.battleUnitInfo))
        unit.luaReflect:PushLuaJson(Key.Avatar, json.encode(battleUnitVo.avatarInfo))
        for i = 1, #battleUnitVo.skills do
            unit.luaReflect:PushLuaJsonArray(Key.Skill, json.encode(battleUnitVo.skills[i].skillInfo))
        end
    end
end

---@param unit Game.Modules.World.Items.BattleUnit
---@param jsonData string
function LuaReflectHelper.JsonToLua(unit, key, jsonData)
    local Config
    if key == Key.BattleUnitInfo then
        Config = BattleUnitInfo
    elseif key == Key.Avatar then
        Config = AvatarInfo
    elseif key == Key.Skill then
        Config = SkillConfig
    elseif key == Key.Performance then
        Config = PerformanceConfig
    elseif key == Key.Anim then
        Config = PerformanceConfig.animData
    elseif key == Key.Account then
        Config = AccountConfig
    end
    if Config then
        local newData = json.decode(jsonData) ---@type AccountInfo
        local oldData = Config.Get(newData.id)
        ObjectUtil.copy(newData, oldData)
    else
        logError("No config with - " .. key)
    end
end

return LuaReflectHelper