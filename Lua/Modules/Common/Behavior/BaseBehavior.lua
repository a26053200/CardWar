---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhengnan.
--- DateTime: 2019/5/20 15:51
---

local StateAction = require("Game.Modules.Common.Behavior.StateAction")
local StateMachine = require("Game.Modules.Common.Behavior.StateMachine")
local LuaMonoBehaviour = require("Betel.LuaMonoBehaviour")

---@class Game.Modules.Common.Behavior.BaseBehavior : Betel.LuaMonoBehaviour
---@field New fun() : Game.Modules.Common.Behavior.BaseBehavior
---@field stateMachine FastBehavior.StateMachine
---@field lastBehavior Game.Modules.Common.Behavior.BaseBehavior
---@field fastLuaBehavior FastBehavior.FastLuaBehavior
local BaseBehavior = class("Game.Modules.Common.Behavior.BaseBehavior",LuaMonoBehaviour)

---@param gameObject UnityEngine.GameObject
function BaseBehavior:Ctor(gameObject)
    BaseBehavior.super.Ctor(self, gameObject)

    if self.gameObject then
        self.stateMachine = self.gameObject:AddComponent(typeof(FastBehavior.StateMachine))
        self.fastLuaBehavior = FastLuaBehavior.New(self.stateMachine)
    end
end

---@param OnStateEnter Handler
function BaseBehavior:AppendState(OnStateEnter, name)
    name = name == nil and "AppendState:" .. self.fastLuaBehavior.id or name
    self.fastLuaBehavior:AppendState(function()
        OnStateEnter:Execute()
    end , name)
end

---@return Game.Modules.Common.Behavior.BaseBehavior
function BaseBehavior:CreateBehavior()
    local behavior = BaseBehavior.New(self.gameObject)
    return behavior
end

---@param behavior Game.Modules.Common.Behavior.BaseBehavior
function BaseBehavior:AppendBehavior(behavior, name)
    name = name == nil and "Sub BaseBehavior id:" .. self.fastLuaBehavior.id or name
    self.fastLuaBehavior:AppendBehavior(behavior.fastLuaBehavior, name)
end

---@param interval number
function BaseBehavior:AppendInterval(interval)
    self.fastLuaBehavior:AppendInterval(interval)
end

---@param node FastBehavior.StateNode .. tostring(handler.caller)
function BaseBehavior:AppendStateNode(node)
    self.fastLuaBehavior:AppendStateNode(node)
end

function BaseBehavior:Run()
    self.fastLuaBehavior:Run()
end

function BaseBehavior:Stop()
    self.fastLuaBehavior:Stop()
end

function BaseBehavior:NextState()
    self.fastLuaBehavior:NextState()
end

function BaseBehavior:Debug(msg)
    --print(string.format("<color=#FFFF00FF> [%s-%s] </color>%s",self.gameObject.name, self.fastLuaBehavior.id, msg))
end

---@param node StateNode
function BaseBehavior:Dispose()
    BaseBehavior.super.Dispose(self)
    self.fastLuaBehavior:Stop()
end

return BaseBehavior